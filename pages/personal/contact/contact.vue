<template>
	<view class="page">
		<scroll-view class="scrollList" scroll-y :scroll-into-view="scrollViewId" :style="{height:winHeight + 'px;'}">
			<view class="uni-list">
				<view class="uni-list-cell" hover-class="uni-list-cell-hover">
					<view class="uni-media-list">
						<image class="uni-media-list-logo" src="../../../static/xinpy.png"></image>
						<view class="uni-media-list-body">
							<view class="uni-media-list-text-top me-list-top">新朋友</view>
						</view>
					</view>						
				</view>
				<view class="uni-list-cell" hover-class="uni-list-cell-hover">
					<view class="uni-media-list">
						<image class="uni-media-list-logo" src="../../../static/qunliao.png"></image>
						<view class="uni-media-list-body">
							<view class="uni-media-list-text-top me-list-top">群聊</view>
						</view>
					</view>						
				</view>
			</view>			
			<view class="uni-list">				
				<block v-for="(list,key) in lists" :key="key" v-if="list.data[0]">
					<view class="uni-list-cell-divider" :id="list.letter">
						{{list.letter}}
					</view>
					<view class="uni-list-cell" hover-class="uni-list-cell-hover" v-for="(item,index) in list.data" :key="index" :class="list.data.length -1 == index ? 'uni-list-cell-last' : ''">
						<view class="uni-media-list">
							<!-- <image class="uni-media-list-logo me-list-logo" :src="item.img"></image> -->
							<image class="uni-media-list-logo me-list-logo" src="../../../static/tongxunlu4.png"></image>
							<view class="uni-media-list-body">
								<view class="uni-media-list-text-top">{{item.name}}</view>
								<view class="uni-media-list-text-bottom uni-ellipsis">{{item.title}}</view>
							</view>
						</view>
					</view>
				</block>
			</view>
		</scroll-view>
		<view class="uni-indexed-list-bar" :class="touchmove ? 'active' : ''" @touchstart="touchStart" @touchmove="touchMove" @touchend="touchEnd" @touchcancel="touchCancel" :style="{height:winHeight + 'px;'}">
			<text v-for="(list,key) in lists" :key="key" class="uni-indexed-list-text" :class="touchmoveIndex == key ? 'active' : ''"
			    :style="{heigth:itemHeight + 'px',lineHeight:itemHeight + 'px'}">{{list.letter}}</text>
		</view>
		<view class="uni-indexed-list-alert" v-if="touchmove">
			{{lists[touchmoveIndex].letter}}
		</view>
	</view>
</template>

<script>
	import util from '../../../common/util.js';
	export default {
		data() {
			return {
				lists: [],
				touchmove: false,
				touchmoveIndex: -1,
				itemHeight: 0,
				winHeight:0,
				scrollViewId: "A"
			}
		},
		onLoad() {
// 			uni.request({
// 				url: 'https://easy-mock.com/mock/5bed59917939e615b8bbdbc2/me/contact',
// 				method: 'GET',
// 				data: {},
// 				success: res => {
// 					this.lists = res.data.list;
// 				},
// 				fail: () => {},
// 				complete: () => {}
// 			});
			this.lists = util.contactList;
			
			let winHeight = uni.getSystemInfoSync().windowHeight;
			this.itemHeight = winHeight / 26; // 26个英文字母
			this.winHeight = winHeight;
		},
		methods: {
			touchStart(e) {
				this.touchmove = true;
				let pageY = e.touches[0].pageY;
				let index = Math.floor(pageY / this.itemHeight);
				this.scrollViewId = this.lists[index].letter;
				this.touchmoveIndex = index;
			},
			touchMove(e) {
				let pageY = e.touches[0].pageY;
				let index = Math.floor(pageY / this.itemHeight);
				this.scrollViewId = this.lists[index].letter;
				this.touchmoveIndex = index;
			},
			touchEnd() {
				this.touchmove = false;
				this.touchmoveIndex = -1;
			},
			touchCancel(){
				this.touchmove = false;
				this.touchmoveIndex = -1;
			}
		}
	}
</script>

<style>
	.page {
		display: flex;
		flex-direction: row;
		width: 100%;
	}

	.scrollList {
		flex: 1;
		height: 100vh;
	}
	
	.me-list-top{
		line-height: 2.4em;
	}
	
	.me-list-logo {
		border-radius: 50%;
	}
	
	.uni-indexed-list-bar {
		width: 46upx;
		height: 100vh;
		background-color: lightgrey;
		display: flex;
		flex-direction: column;
	}

	.uni-indexed-list-bar.active {
		background-color: rgb(200, 200, 200);
	}

	.uni-indexed-list-text {
		color: #aaa;
		font-size: 22upx;
		text-align: center;
	}

	.uni-indexed-list-bar.active .uni-indexed-list-text {
		color: #333;
	}

	.uni-indexed-list-text.active,
	.uni-indexed-list-bar.active .uni-indexed-list-text.active {
		color: #FFFFFF;
		border-radius: 50%;
		background-color: #007AFF;
	}

	.uni-indexed-list-alert {
		position: absolute;
		z-index: 20;
		width: 160upx;
		height: 160upx;
		left: 50%;
		top: 50%;
		margin-left: -80upx;
		margin-top: -80upx;
		border-radius: 80upx;
		text-align: center;
		line-height: 160upx;
		font-size: 70upx;
		color: #fff;
		background-color: rgba(0, 0, 0, 0.5);
	}
</style>
